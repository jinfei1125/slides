<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Looking at data</title>
    <meta charset="utf-8" />
    <meta name="author" content="MACS 40700   University of Chicago" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link href="index_files/panelset/panelset.css" rel="stylesheet" />
    <script src="index_files/panelset/panelset.js"></script>
    <link href="index_files/countdown/countdown.css" rel="stylesheet" />
    <script src="index_files/countdown/countdown.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Looking at data
### MACS 40700 <br /> University of Chicago

---






class: middle, inverse

# A/B testing

---

## Data: College education costs

.pull-left[

- Data on four year colleges and universities in the United States (2018-19)

- Extracted from College Scorecard API

- Source: `rcfss::scorecard`

]

.pull-right[

&lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;The 4 stages of a morning lecture &lt;a href="https://t.co/B7v6WLtX3J"&gt;pic.twitter.com/B7v6WLtX3J&lt;/a&gt;&lt;/p&gt;&amp;mdash; College Student (@ColIegeStudent) &lt;a href="https://twitter.com/ColIegeStudent/status/829377468595306500?ref_src=twsrc%5Etfw"&gt;February 8, 2017&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;
]

---

## `rcfss::scorecard`


```r
library(tidyverse)
# remotes::install_github("uc-cfss/rcfss)
library(rcfss)

glimpse(scorecard)
```

```
## Rows: 1,732
## Columns: 14
## $ unitid    &lt;dbl&gt; 100654, 100663, 100706, 100724, 100751, 100830, 100858, 1009…
## $ name      &lt;chr&gt; "Alabama A &amp; M University", "University of Alabama at Birmin…
## $ state     &lt;chr&gt; "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", …
## $ type      &lt;fct&gt; "Public", "Public", "Public", "Public", "Public", "Public", …
## $ admrate   &lt;dbl&gt; 0.9175, 0.7366, 0.8257, 0.9690, 0.8268, 0.9044, 0.8067, 0.53…
## $ satavg    &lt;dbl&gt; 939, 1234, 1319, 946, 1261, 1082, 1300, 1230, 1066, NA, 1076…
## $ cost      &lt;dbl&gt; 23053, 24495, 23917, 21866, 29872, 19849, 31590, 32095, 3431…
## $ netcost   &lt;dbl&gt; 14990, 16953, 15860, 13650, 22597, 13987, 24104, 22107, 2071…
## $ avgfacsal &lt;dbl&gt; 69381, 99441, 87192, 64989, 92619, 71343, 96642, 56646, 5400…
## $ pctpell   &lt;dbl&gt; 0.7019, 0.3512, 0.2536, 0.7627, 0.1772, 0.4644, 0.1455, 0.23…
## $ comprate  &lt;dbl&gt; 0.2974, 0.6340, 0.5768, 0.3276, 0.7110, 0.3401, 0.7911, 0.69…
## $ firstgen  &lt;dbl&gt; 0.3658281, 0.3412237, 0.3101322, 0.3434343, 0.2257127, 0.381…
## $ debt      &lt;dbl&gt; 15250, 15085, 14000, 17500, 17671, 12000, 17500, 16000, 1425…
## $ locale    &lt;fct&gt; City, City, City, City, City, City, City, City, City, Suburb…
```

---

## A simple visualization

.panelset[
&lt;div class="panel"&gt;
&lt;div class="panel-name"&gt;Code&lt;/div&gt;

```r
ggplot(scorecard, aes(x = satavg, y = netcost)) +
  geom_point(alpha = 0.5, size = 2) +
  geom_smooth(method = "lm", se = FALSE, size = 0.7) +
  labs(
    x = "Average SAT score",
    y = "Net cost of attendance (USD)",
    title = "Test scores and net cost of attendance in US universities"
  )
```



&lt;/div&gt;

&lt;div class="panel"&gt;
&lt;div class="panel-name"&gt;Plot&lt;/div&gt;

&lt;img src="index_files/figure-html/unnamed-chunk-2-1.png" width="70%" style="display: block; margin: auto;" /&gt;

&lt;/div&gt;
]

---

## New variable: `pctpell_cat`


```r
scorecard &lt;- scorecard %&gt;%
  mutate(pctpell_cat = cut_interval(x = pctpell, n = 6)) %&gt;%
  drop_na(pctpell_cat)

scorecard %&gt;%
  select(pctpell, pctpell_cat)
```

```
## # A tibble: 1,728 × 2
##    pctpell pctpell_cat  
##      &lt;dbl&gt; &lt;fct&gt;        
##  1   0.702 (0.667,0.833]
##  2   0.351 (0.333,0.5]  
##  3   0.254 (0.167,0.333]
##  4   0.763 (0.667,0.833]
##  5   0.177 (0.167,0.333]
##  6   0.464 (0.333,0.5]  
##  7   0.146 [0,0.167]    
##  8   0.236 (0.167,0.333]
##  9   0.488 (0.333,0.5]  
## 10   0.706 (0.667,0.833]
## # … with 1,718 more rows
```

---

## Distribution of `pctpell_cat`


```r
scorecard &lt;- scorecard %&gt;%
  mutate(pctpell_cat = cut_interval(x = pctpell, n = 6)) %&gt;%
  drop_na(pctpell_cat)

scorecard %&gt;%
  count(pctpell_cat)
```

```
## # A tibble: 6 × 2
##   pctpell_cat       n
##   &lt;fct&gt;         &lt;int&gt;
## 1 [0,0.167]       157
## 2 (0.167,0.333]   610
## 3 (0.333,0.5]     632
## 4 (0.5,0.667]     225
## 5 (0.667,0.833]    74
## 6 (0.833,1]        30
```

---

## A slightly more complex visualization

.panelset[
&lt;div class="panel"&gt;
&lt;div class="panel-name"&gt;Code&lt;/div&gt;

```r
ggplot(scorecard, aes(x = satavg, y = netcost, color = pctpell_cat)) +
  geom_point(alpha = 0.5, show.legend = FALSE) +
  geom_smooth(method = "lm", se = FALSE, size = 0.5, show.legend = FALSE) +
  facet_wrap(vars(pctpell_cat)) +
  labs(
    x = "Average SAT score",
    y = "Net cost of attendance (USD)",
    color = "Percentage of Pell grant recipients",
    title = "Test scores and net cost of attendance in US universities"
  )
```



&lt;/div&gt;

&lt;div class="panel"&gt;
&lt;div class="panel-name"&gt;Plot&lt;/div&gt;

&lt;img src="index_files/figure-html/unnamed-chunk-5-1.png" width="90%" style="display: block; margin: auto;" /&gt;

&lt;/div&gt;
]

---

class: middle

.task[
In the next two slides, the same plots are created with different "cosmetic" choices. Examine the plots two given (Plot A and Plot B), and decide whcih one you prefer.
]

---

## Test 1

.panelset[
.panel[.panel-name[Plot A]
&lt;img src="index_files/figure-html/test-1-a-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Plot B]
&lt;img src="index_files/figure-html/test-1-b-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
]

---

## Test 2

.panelset[
.panel[.panel-name[Plot A]
&lt;img src="index_files/figure-html/unnamed-chunk-6-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Plot B]
&lt;img src="index_files/figure-html/test-2-b-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
]

---

class: middle

.large[
.hand[
a deeper look at the plotting code...
]
]

---

## Minimal theme + viridis scale, default option

.panelset[
.panel[.panel-name[Plot]
&lt;img src="index_files/figure-html/unnamed-chunk-7-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]

```r
ggplot(scorecard, aes(x = satavg, y = netcost, color = pctpell_cat)) +
  geom_point(alpha = 0.5, show.legend = FALSE) +
  geom_smooth(method = "lm", se = FALSE, size = 0.5, show.legend = FALSE) +
  facet_wrap(vars(pctpell_cat)) +
  labs(
    x = "Average SAT score",
    y = "Net cost of attendance (USD)",
    color = "Percentage of Pell grant recipients",
    title = "Test scores and net cost of attendance in US universities"
  ) +
* theme_minimal(base_size = 16) +
* scale_color_viridis_d(end = 0.9)
```
]
]

---

## Viridis scale, option A (magma)

.panelset[
.panel[.panel-name[Plot]
&lt;img src="index_files/figure-html/unnamed-chunk-9-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]

```r
ggplot(scorecard, aes(x = satavg, y = netcost, color = pctpell_cat)) +
  geom_point(alpha = 0.5, show.legend = FALSE) +
  geom_smooth(method = "lm", se = FALSE, size = 0.5, show.legend = FALSE) +
  facet_wrap(vars(pctpell_cat)) +
  labs(
    x = "Average SAT score",
    y = "Net cost of attendance (USD)",
    color = "Percentage of Pell grant recipients",
    title = "Test scores and net cost of attendance in US universities"
  ) +
  theme_minimal(base_size = 16) +
* scale_color_viridis_d(end = 0.8, option = "A")
```
]
]

---

## Dark theme + further theme customization

.panelset[
.panel[.panel-name[Plot]
&lt;img src="index_files/figure-html/unnamed-chunk-11-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]

```r
ggplot(scorecard, aes(x = satavg, y = netcost, color = pctpell_cat)) +
  geom_point(alpha = 0.5, show.legend = FALSE) +
  geom_smooth(method = "lm", se = FALSE, size = 0.5, show.legend = FALSE) +
  facet_wrap(vars(pctpell_cat)) +
  labs(
    x = "Average SAT score",
    y = "Net cost of attendance (USD)",
    color = "Percentage of Pell grant recipients",
    title = "Test scores and net cost of attendance in US universities"
  ) +
* theme_dark(base_size = 16) +
* scale_color_manual(values = c("yellow", "blue", "orange", "red", "green", "white")) +
* theme(
*   text = element_text(color = "red", face = "bold.italic"),
*   plot.background = element_rect(fill = "yellow")
* )
```
]
]

---

class: middle, inverse

# What makes bad figures bad?

---

## Bad taste

&lt;img src="index_files/figure-html/unnamed-chunk-13-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---

## Data-to-ink ratio

.pull-left-wide[
Tufte strongly recommends maximizing the **data-to-ink ratio** this in the Visual Display of Quantitative Information (Tufte, 1983).

&gt; Graphical excellence is the well-designed presentation of interesting data—a matter of substance, of statistics, and of design … [It] consists of complex ideas communicated with clarity, precision, and efficiency. … [It] is that which gives to the viewer the greatest number of ideas in the shortest time with the least ink in the smallest space … [It] is nearly always multivariate … And graphical excellence requires telling the truth about the data. (Tufte, 1983, p. 51).

]
.pull-right-narrow[
&lt;img src="images/tufte-visual-display-cover.png" title="Cover of Visual Display of Quantitative Information, Tufte (1983)." alt="Cover of Visual Display of Quantitative Information, Tufte (1983)." width="100%" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---

.task[
Which of the plots has higher data-to-ink ratio?
]



.panelset[
.panel[.panel-name[Plot A]
&lt;img src="index_files/figure-html/mean-netcost-pctpell-a-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Plot B]
&lt;img src="index_files/figure-html/mean-netcost-pctpell-b-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]
]

---

class: middle

.large[
.hand[
a deeper look at the plotting code...
]
]

---

## Summary statistics


```r
mean_netcost_pctpell &lt;- scorecard %&gt;%
  group_by(pctpell_cat) %&gt;%
  summarise(mean_netcost = mean(netcost, na.rm = TRUE))

mean_netcost_pctpell
```

```
## # A tibble: 6 × 2
##   pctpell_cat   mean_netcost
##   &lt;fct&gt;                &lt;dbl&gt;
## 1 [0,0.167]           29991.
## 2 (0.167,0.333]       22477.
## 3 (0.333,0.5]         18655.
## 4 (0.5,0.667]         17428.
## 5 (0.667,0.833]       14997.
## 6 (0.833,1]           10100.
```

---

## Barplot

.panelset[
.panel[.panel-name[Plot]
&lt;img src="index_files/figure-html/unnamed-chunk-16-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]

```r
ggplot(mean_netcost_pctpell, aes(y = pctpell_cat, x = mean_netcost)) +
* geom_col() +
  labs(
    x = "Mean net cost of attendance", y = "Pell grant recipients",
    title = "Mean net cost of attendance, by Pell grant recipients"
  ) +
  theme_minimal(base_size = 16)
```
]
]


---

## Scatterplot

.panelset[
.panel[.panel-name[Plot]
&lt;img src="index_files/figure-html/unnamed-chunk-18-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]

```r
ggplot(mean_netcost_pctpell, aes(y = pctpell_cat, x = mean_netcost)) +
* geom_point(size = 4) +
  labs(
    x = "Mean net cost of attendance", y = "Pell grant recipients",
    title = "Mean net cost of attendance, by Pell grant recipients"
  ) +
  theme_minimal(base_size = 16)
```
]
]

---

## Lollipop plot -- a happy medium?

.panelset[
.panel[.panel-name[Plot]
&lt;img src="index_files/figure-html/mean-netcost-pctpell-lollipop-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]

```r
ggplot(mean_netcost_pctpell, aes(y = pctpell_cat, x = mean_netcost)) +
  geom_point(size = 4) +
* geom_segment(
*   aes(
*     x = 0, xend = mean_netcost,
*     y = pctpell_cat, yend = pctpell_cat
*   )
* ) +
  labs(
    x = "Mean net cost of attendance", y = "Pell grant recipients",
    title = "Mean net cost of attendance, by Pell grant recipients"
  ) +
  theme_minimal(base_size = 16)
```
]
]

---

## Activity: Napoleon’s retreat

.pull-left-wide[
.task[
.small[
This is Minard’s visualization of Napoleon’s retreat. Discuss in a pair (or group) the features of the following visualization. What are the variables plotted? Which aesthetics are they mapped to?
]
]
]

&lt;img src="images/minard.jpg" title="Minard’s visualization of Napoleon’s retreat" alt="Minard’s visualization of Napoleon’s retreat" width="83%" style="display: block; margin: auto;" /&gt;

<div class="countdown" id="timer_624365a0" style="top:0;right:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

## Bad data

.panelset[
.panel[.panel-name[Original]
&lt;img src="images/healy-democracy-nyt-version.png" title="A crisis of faith in democracy? New York Times." alt="A crisis of faith in democracy? New York Times." width="50%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Improved]
&lt;img src="images/healy-democracy-voeten-version-2.png" title="A crisis of faith in democracy? New York Times." alt="A crisis of faith in democracy? New York Times." width="50%" style="display: block; margin: auto;" /&gt;
]
]

.footnote[
Healy, Data Visualization: A practical introduction. [Chapter 1](https://socviz.co/lookatdata.html). Figures 1.8 and 1.9.
]

---

## Bad perception

&lt;img src="images/healy-perception-curves.png" title="Aspect ratios affect our perception of rates of change, modeled after an example by William S. Cleveland." alt="Aspect ratios affect our perception of rates of change, modeled after an example by William S. Cleveland." width="80%" style="display: block; margin: auto;" /&gt;

.footnote[
Healy, Data Visualization: A practical introduction. [Chapter 1](https://socviz.co/lookatdata.html). Figure 1.12.
]

---

class: middle, inverse

# Aesthetic mappings in ggplot2

---

## A second look: lollipop plot

.panelset[
.panel[.panel-name[Plot]
&lt;img src="index_files/figure-html/mean-netcost-pctpell-lollipop-layer-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]

```r
ggplot(mean_netcost_pctpell, aes(y = pctpell_cat, x = mean_netcost)) +
  geom_point(size = 4) +
  geom_segment(
    aes(
      x = 0, xend = mean_netcost,
      y = pctpell_cat, yend = pctpell_cat
    )
  ) +
  labs(
    x = "Mean net cost of attendance", y = "Pell grant recipients",
    title = "Mean net cost of attendance, by Pell grant recipients"
  ) +
  theme_minimal(base_size = 16)
```
]
]

---

## Activity: Spot the difference I

.task[
Can you spot the differences between the code here and the one provided in the previous slide? Are there any differences in the resulting plot? Work in a pair (or group) to answer.
]

.panelset[
.panel[.panel-name[Plot]
&lt;img src="index_files/figure-html/mean-netcost-pctpell-lollipop-global-1.png" width="50%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]

```r
ggplot(mean_netcost_pctpell, aes(y = pctpell_cat, x = mean_netcost)) +
  geom_point(size = 4) +
  geom_segment(aes(
    xend = 0,
    yend = pctpell_cat
  )) +
  labs(
    x = "Mean net cost of attendance", y = "Pell grant recipients",
    title = "Mean net cost of attendance, by Pell grant recipients"
  ) +
  theme_minimal(base_size = 16)
```
]
]

<div class="countdown" id="timer_62436653" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

## Global vs. layer-specific aesthetics

- Aesthetic mappings can be supplied in the initial `ggplot()` call, in individual layers, or in some combination of both.

- Within each layer, you can add, override, or remove mappings.

- If you only have one layer in the plot, the way you specify aesthetics doesn’t make any difference. However, the distinction is important when you start adding additional layers.

---

## Wrap up

.task[
Think back to all the plots you saw in the lecture, without flipping back through the slides. Which plot first comes to mind? Describe it in words.
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlighStyle": "solarized-light",
"highlightLanguage": "r",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
